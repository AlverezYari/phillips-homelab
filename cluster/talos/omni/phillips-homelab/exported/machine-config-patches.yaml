metadata:
    namespace: default
    type: ClusterMachineConfigPatches.omni.sidero.dev
    id: 03000200-0400-0500-0006-000700080009
    version: 1
    owner: MachineSetStatusController
    phase: running
    created: 2025-03-21T02:13:01Z
    updated: 2025-08-10T07:02:48Z
    labels:
        omni.sidero.dev/cluster: phillips-homelab
        omni.sidero.dev/machine-set: phillips-homelab-workers
        omni.sidero.dev/role-worker:
spec:
    patches:
        - |
          cluster:
              network:
                  cni:
                      name: none
        - |
          cluster:
              proxy:
                  disabled: true
        - |
          cluster:
              extraManifests:
                  - https://raw.githubusercontent.com/AlverezYari/phillips-homelab/refs/heads/main/cluster/talos/omni/phillips-homelab/manifests/namespaces.yml
                  - https://raw.githubusercontent.com/kubernetes-sigs/gateway-api/v1.2.0/config/crd/standard/gateway.networking.k8s.io_gatewayclasses.yaml
                  - https://raw.githubusercontent.com/kubernetes-sigs/gateway-api/v1.2.0/config/crd/standard/gateway.networking.k8s.io_gateways.yaml
                  - https://raw.githubusercontent.com/kubernetes-sigs/gateway-api/v1.2.0/config/crd/standard/gateway.networking.k8s.io_httproutes.yaml
                  - https://raw.githubusercontent.com/kubernetes-sigs/gateway-api/v1.2.0/config/crd/standard/gateway.networking.k8s.io_referencegrants.yaml
                  - https://raw.githubusercontent.com/kubernetes-sigs/gateway-api/v1.2.0/config/crd/standard/gateway.networking.k8s.io_grpcroutes.yaml
                  - https://raw.githubusercontent.com/kubernetes-sigs/gateway-api/v1.2.0/config/crd/experimental/gateway.networking.k8s.io_tlsroutes.yaml
                  - https://raw.githubusercontent.com/AlverezYari/phillips-homelab/refs/heads/main/cluster/talos/omni/phillips-homelab/manifests/L2Announcement.yml
                  - https://raw.githubusercontent.com/AlverezYari/phillips-homelab/refs/heads/main/cluster/talos/omni/phillips-homelab/manifests/argocd-kustomized/final-argocd.yaml
                  - https://raw.githubusercontent.com/alex1989hu/kubelet-serving-cert-approver/main/deploy/standalone-install.yaml
                  - https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml
                  - https://raw.githubusercontent.com/AlverezYari/phillips-homelab/refs/heads/main/cluster/talos/omni/phillips-homelab/manifests/gateways.yml
        - |
          machine:
              kubelet:
                  extraArgs:
                      rotate-server-certificates: true
        - |
          cluster:
            inlineManifests:
              - name: omni-kube-service-exposer
                # adapted from: https://github.com/siderolabs/kube-service-exposer/blob/main/deploy/kube-service-exposer.yaml
                contents: |-
                  apiVersion: rbac.authorization.k8s.io/v1
                  kind: ClusterRole
                  metadata:
                    name: omni-kube-service-exposer
                  rules:
                    - apiGroups: [""]
                      resources: ["services"]
                      verbs: ["get", "list", "watch"]
                  ---
                  apiVersion: v1
                  kind: ServiceAccount
                  metadata:
                    name: omni-kube-service-exposer
                    namespace: kube-system
                  ---
                  apiVersion: rbac.authorization.k8s.io/v1
                  kind: ClusterRoleBinding
                  metadata:
                    name: omni-kube-service-exposer
                  roleRef:
                    apiGroup: rbac.authorization.k8s.io
                    kind: ClusterRole
                    name: omni-kube-service-exposer
                  subjects:
                    - kind: ServiceAccount
                      name: omni-kube-service-exposer
                      namespace: kube-system
                  ---
                  apiVersion: apps/v1
                  kind: DaemonSet
                  metadata:
                    name: omni-kube-service-exposer
                    namespace: kube-system
                  spec:
                    selector:
                      matchLabels:
                        app.kubernetes.io/name: omni-kube-service-exposer
                    template:
                      metadata:
                        labels:
                          app.kubernetes.io/name: omni-kube-service-exposer
                      spec:
                        serviceAccountName: omni-kube-service-exposer
                        hostNetwork: true
                        dnsPolicy: ClusterFirstWithHostNet
                        tolerations:
                          - operator: Exists
                        containers:
                          - name: omni-kube-service-exposer
                            image: ghcr.io/siderolabs/kube-service-exposer:v0.2.0
                            args:
                              - --debug=false
                              - --annotation-key=omni-kube-service-exposer.sidero.dev/port
                              # siderolink CIDR
                              - --bind-cidrs="fdae:41e4:649b:9303::/64"
                              - --disallowed-host-port-ranges=6443,10250,50000-50001
        - |
          machine:
              install:
                  disk: /dev/nvme0n1
        - |
          machine:
              install:
                  disk: /dev/nvme0n1
        - |-
          machine:
            network:
              hostname: homelab-02
        - |-
          apiVersion: v1alpha1
          kind: ExtensionServiceConfig
          name: nut-client
          configFiles:
              - content: "MONITOR ups@192.168.10.195:3493 1 monuser secret slave"
                mountPath: /usr/local/etc/nut/upsmon.conf
          environment:
              - NUT_UPS=ups
        - "machine:\r\n  install:\r\n    disk: /dev/nvme0n1"
        - "machine:\r\n  install:\r\n    disk: /dev/nvme0n1"
        - |-
          machine:
            network:
              hostname: homelab-02
---
metadata:
    namespace: default
    type: ClusterMachineConfigPatches.omni.sidero.dev
    id: 169b5237-8624-af49-8f83-98bd808f9e04
    version: 1
    owner: MachineSetStatusController
    phase: running
    created: 2025-03-21T02:34:30Z
    updated: 2025-08-10T06:59:26Z
    labels:
        omni.sidero.dev/cluster: phillips-homelab
        omni.sidero.dev/machine-set: phillips-homelab-workers
        omni.sidero.dev/role-worker:
spec:
    patches:
        - |
          cluster:
              network:
                  cni:
                      name: none
        - |
          cluster:
              proxy:
                  disabled: true
        - |
          cluster:
              extraManifests:
                  - https://raw.githubusercontent.com/AlverezYari/phillips-homelab/refs/heads/main/cluster/talos/omni/phillips-homelab/manifests/namespaces.yml
                  - https://raw.githubusercontent.com/kubernetes-sigs/gateway-api/v1.2.0/config/crd/standard/gateway.networking.k8s.io_gatewayclasses.yaml
                  - https://raw.githubusercontent.com/kubernetes-sigs/gateway-api/v1.2.0/config/crd/standard/gateway.networking.k8s.io_gateways.yaml
                  - https://raw.githubusercontent.com/kubernetes-sigs/gateway-api/v1.2.0/config/crd/standard/gateway.networking.k8s.io_httproutes.yaml
                  - https://raw.githubusercontent.com/kubernetes-sigs/gateway-api/v1.2.0/config/crd/standard/gateway.networking.k8s.io_referencegrants.yaml
                  - https://raw.githubusercontent.com/kubernetes-sigs/gateway-api/v1.2.0/config/crd/standard/gateway.networking.k8s.io_grpcroutes.yaml
                  - https://raw.githubusercontent.com/kubernetes-sigs/gateway-api/v1.2.0/config/crd/experimental/gateway.networking.k8s.io_tlsroutes.yaml
                  - https://raw.githubusercontent.com/AlverezYari/phillips-homelab/refs/heads/main/cluster/talos/omni/phillips-homelab/manifests/L2Announcement.yml
                  - https://raw.githubusercontent.com/AlverezYari/phillips-homelab/refs/heads/main/cluster/talos/omni/phillips-homelab/manifests/argocd-kustomized/final-argocd.yaml
                  - https://raw.githubusercontent.com/alex1989hu/kubelet-serving-cert-approver/main/deploy/standalone-install.yaml
                  - https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml
                  - https://raw.githubusercontent.com/AlverezYari/phillips-homelab/refs/heads/main/cluster/talos/omni/phillips-homelab/manifests/gateways.yml
        - |
          machine:
              kubelet:
                  extraArgs:
                      rotate-server-certificates: true
        - |
          cluster:
            inlineManifests:
              - name: omni-kube-service-exposer
                # adapted from: https://github.com/siderolabs/kube-service-exposer/blob/main/deploy/kube-service-exposer.yaml
                contents: |-
                  apiVersion: rbac.authorization.k8s.io/v1
                  kind: ClusterRole
                  metadata:
                    name: omni-kube-service-exposer
                  rules:
                    - apiGroups: [""]
                      resources: ["services"]
                      verbs: ["get", "list", "watch"]
                  ---
                  apiVersion: v1
                  kind: ServiceAccount
                  metadata:
                    name: omni-kube-service-exposer
                    namespace: kube-system
                  ---
                  apiVersion: rbac.authorization.k8s.io/v1
                  kind: ClusterRoleBinding
                  metadata:
                    name: omni-kube-service-exposer
                  roleRef:
                    apiGroup: rbac.authorization.k8s.io
                    kind: ClusterRole
                    name: omni-kube-service-exposer
                  subjects:
                    - kind: ServiceAccount
                      name: omni-kube-service-exposer
                      namespace: kube-system
                  ---
                  apiVersion: apps/v1
                  kind: DaemonSet
                  metadata:
                    name: omni-kube-service-exposer
                    namespace: kube-system
                  spec:
                    selector:
                      matchLabels:
                        app.kubernetes.io/name: omni-kube-service-exposer
                    template:
                      metadata:
                        labels:
                          app.kubernetes.io/name: omni-kube-service-exposer
                      spec:
                        serviceAccountName: omni-kube-service-exposer
                        hostNetwork: true
                        dnsPolicy: ClusterFirstWithHostNet
                        tolerations:
                          - operator: Exists
                        containers:
                          - name: omni-kube-service-exposer
                            image: ghcr.io/siderolabs/kube-service-exposer:v0.2.0
                            args:
                              - --debug=false
                              - --annotation-key=omni-kube-service-exposer.sidero.dev/port
                              # siderolink CIDR
                              - --bind-cidrs="fdae:41e4:649b:9303::/64"
                              - --disallowed-host-port-ranges=6443,10250,50000-50001
        - |
          machine:
              install:
                  disk: /dev/nvme0n1
        - |
          machine:
              install:
                  disk: /dev/nvme0n1
        - |-
          apiVersion: v1alpha1
          kind: ExtensionServiceConfig
          name: nut-client
          configFiles:
              - content: "MONITOR ups@192.168.10.195:3493 1 monuser secret slave"
                mountPath: /usr/local/etc/nut/upsmon.conf
          environment:
              - NUT_UPS=ups
        - |-
          machine:
            network:
              hostname: "homelab-03"
---
metadata:
    namespace: default
    type: ClusterMachineConfigPatches.omni.sidero.dev
    id: 42bf6767-4044-db4b-bf34-98bd8093f5e4
    version: 1
    owner: MachineSetStatusController
    phase: running
    created: 2025-03-18T22:30:35Z
    updated: 2025-08-10T03:51:18Z
    labels:
        omni.sidero.dev/cluster: phillips-homelab
        omni.sidero.dev/machine-set: phillips-homelab-control-planes
        omni.sidero.dev/role-controlplane:
spec:
    patches:
        - |
          cluster:
              network:
                  cni:
                      name: none
        - |
          cluster:
              proxy:
                  disabled: true
        - |
          cluster:
              extraManifests:
                  - https://raw.githubusercontent.com/AlverezYari/phillips-homelab/refs/heads/main/cluster/talos/omni/phillips-homelab/manifests/namespaces.yml
                  - https://raw.githubusercontent.com/kubernetes-sigs/gateway-api/v1.2.0/config/crd/standard/gateway.networking.k8s.io_gatewayclasses.yaml
                  - https://raw.githubusercontent.com/kubernetes-sigs/gateway-api/v1.2.0/config/crd/standard/gateway.networking.k8s.io_gateways.yaml
                  - https://raw.githubusercontent.com/kubernetes-sigs/gateway-api/v1.2.0/config/crd/standard/gateway.networking.k8s.io_httproutes.yaml
                  - https://raw.githubusercontent.com/kubernetes-sigs/gateway-api/v1.2.0/config/crd/standard/gateway.networking.k8s.io_referencegrants.yaml
                  - https://raw.githubusercontent.com/kubernetes-sigs/gateway-api/v1.2.0/config/crd/standard/gateway.networking.k8s.io_grpcroutes.yaml
                  - https://raw.githubusercontent.com/kubernetes-sigs/gateway-api/v1.2.0/config/crd/experimental/gateway.networking.k8s.io_tlsroutes.yaml
                  - https://raw.githubusercontent.com/AlverezYari/phillips-homelab/refs/heads/main/cluster/talos/omni/phillips-homelab/manifests/L2Announcement.yml
                  - https://raw.githubusercontent.com/AlverezYari/phillips-homelab/refs/heads/main/cluster/talos/omni/phillips-homelab/manifests/argocd-kustomized/final-argocd.yaml
                  - https://raw.githubusercontent.com/alex1989hu/kubelet-serving-cert-approver/main/deploy/standalone-install.yaml
                  - https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml
                  - https://raw.githubusercontent.com/AlverezYari/phillips-homelab/refs/heads/main/cluster/talos/omni/phillips-homelab/manifests/gateways.yml
        - |
          machine:
              kubelet:
                  extraArgs:
                      rotate-server-certificates: true
        - |
          cluster:
            inlineManifests:
              - name: omni-kube-service-exposer
                # adapted from: https://github.com/siderolabs/kube-service-exposer/blob/main/deploy/kube-service-exposer.yaml
                contents: |-
                  apiVersion: rbac.authorization.k8s.io/v1
                  kind: ClusterRole
                  metadata:
                    name: omni-kube-service-exposer
                  rules:
                    - apiGroups: [""]
                      resources: ["services"]
                      verbs: ["get", "list", "watch"]
                  ---
                  apiVersion: v1
                  kind: ServiceAccount
                  metadata:
                    name: omni-kube-service-exposer
                    namespace: kube-system
                  ---
                  apiVersion: rbac.authorization.k8s.io/v1
                  kind: ClusterRoleBinding
                  metadata:
                    name: omni-kube-service-exposer
                  roleRef:
                    apiGroup: rbac.authorization.k8s.io
                    kind: ClusterRole
                    name: omni-kube-service-exposer
                  subjects:
                    - kind: ServiceAccount
                      name: omni-kube-service-exposer
                      namespace: kube-system
                  ---
                  apiVersion: apps/v1
                  kind: DaemonSet
                  metadata:
                    name: omni-kube-service-exposer
                    namespace: kube-system
                  spec:
                    selector:
                      matchLabels:
                        app.kubernetes.io/name: omni-kube-service-exposer
                    template:
                      metadata:
                        labels:
                          app.kubernetes.io/name: omni-kube-service-exposer
                      spec:
                        serviceAccountName: omni-kube-service-exposer
                        hostNetwork: true
                        dnsPolicy: ClusterFirstWithHostNet
                        tolerations:
                          - operator: Exists
                        containers:
                          - name: omni-kube-service-exposer
                            image: ghcr.io/siderolabs/kube-service-exposer:v0.2.0
                            args:
                              - --debug=false
                              - --annotation-key=omni-kube-service-exposer.sidero.dev/port
                              # siderolink CIDR
                              - --bind-cidrs="fdae:41e4:649b:9303::/64"
                              - --disallowed-host-port-ranges=6443,10250,50000-50001
        - |
          cluster:
              allowSchedulingOnControlPlanes: true
        - |
          machine:
              install:
                  disk: /dev/nvme0n1
        - |-
          machine:
            nodeLabels:
              mem: 32GiB
        - |-
          machine:
            network:
              hostname: homelab-01
        - |-
          apiVersion: v1alpha1
          kind: ExtensionServiceConfig
          name: nut-client
          configFiles:
              - content: "MONITOR ups@192.168.10.195:3493 1 monuser secret slave"
                mountPath: /usr/local/etc/nut/upsmon.conf
          environment:
              - NUT_UPS=ups
---
metadata:
    namespace: default
    type: ClusterMachineConfigPatches.omni.sidero.dev
    id: 76567b10-4884-4b1d-abc5-345a60522d43
    version: 1
    owner: MachineSetStatusController
    phase: running
    created: 2025-08-10T06:00:20Z
    updated: 2025-08-10T19:48:46Z
    labels:
        omni.sidero.dev/cluster: phillips-homelab
        omni.sidero.dev/machine-set: phillips-homelab-we0cfde
        omni.sidero.dev/role-worker:
spec:
    patches:
        - |
          cluster:
              network:
                  cni:
                      name: none
        - |
          cluster:
              proxy:
                  disabled: true
        - |
          cluster:
              extraManifests:
                  - https://raw.githubusercontent.com/AlverezYari/phillips-homelab/refs/heads/main/cluster/talos/omni/phillips-homelab/manifests/namespaces.yml
                  - https://raw.githubusercontent.com/kubernetes-sigs/gateway-api/v1.2.0/config/crd/standard/gateway.networking.k8s.io_gatewayclasses.yaml
                  - https://raw.githubusercontent.com/kubernetes-sigs/gateway-api/v1.2.0/config/crd/standard/gateway.networking.k8s.io_gateways.yaml
                  - https://raw.githubusercontent.com/kubernetes-sigs/gateway-api/v1.2.0/config/crd/standard/gateway.networking.k8s.io_httproutes.yaml
                  - https://raw.githubusercontent.com/kubernetes-sigs/gateway-api/v1.2.0/config/crd/standard/gateway.networking.k8s.io_referencegrants.yaml
                  - https://raw.githubusercontent.com/kubernetes-sigs/gateway-api/v1.2.0/config/crd/standard/gateway.networking.k8s.io_grpcroutes.yaml
                  - https://raw.githubusercontent.com/kubernetes-sigs/gateway-api/v1.2.0/config/crd/experimental/gateway.networking.k8s.io_tlsroutes.yaml
                  - https://raw.githubusercontent.com/AlverezYari/phillips-homelab/refs/heads/main/cluster/talos/omni/phillips-homelab/manifests/L2Announcement.yml
                  - https://raw.githubusercontent.com/AlverezYari/phillips-homelab/refs/heads/main/cluster/talos/omni/phillips-homelab/manifests/argocd-kustomized/final-argocd.yaml
                  - https://raw.githubusercontent.com/alex1989hu/kubelet-serving-cert-approver/main/deploy/standalone-install.yaml
                  - https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml
                  - https://raw.githubusercontent.com/AlverezYari/phillips-homelab/refs/heads/main/cluster/talos/omni/phillips-homelab/manifests/gateways.yml
        - |
          machine:
              kubelet:
                  extraArgs:
                      rotate-server-certificates: true
        - |
          cluster:
            inlineManifests:
              - name: omni-kube-service-exposer
                # adapted from: https://github.com/siderolabs/kube-service-exposer/blob/main/deploy/kube-service-exposer.yaml
                contents: |-
                  apiVersion: rbac.authorization.k8s.io/v1
                  kind: ClusterRole
                  metadata:
                    name: omni-kube-service-exposer
                  rules:
                    - apiGroups: [""]
                      resources: ["services"]
                      verbs: ["get", "list", "watch"]
                  ---
                  apiVersion: v1
                  kind: ServiceAccount
                  metadata:
                    name: omni-kube-service-exposer
                    namespace: kube-system
                  ---
                  apiVersion: rbac.authorization.k8s.io/v1
                  kind: ClusterRoleBinding
                  metadata:
                    name: omni-kube-service-exposer
                  roleRef:
                    apiGroup: rbac.authorization.k8s.io
                    kind: ClusterRole
                    name: omni-kube-service-exposer
                  subjects:
                    - kind: ServiceAccount
                      name: omni-kube-service-exposer
                      namespace: kube-system
                  ---
                  apiVersion: apps/v1
                  kind: DaemonSet
                  metadata:
                    name: omni-kube-service-exposer
                    namespace: kube-system
                  spec:
                    selector:
                      matchLabels:
                        app.kubernetes.io/name: omni-kube-service-exposer
                    template:
                      metadata:
                        labels:
                          app.kubernetes.io/name: omni-kube-service-exposer
                      spec:
                        serviceAccountName: omni-kube-service-exposer
                        hostNetwork: true
                        dnsPolicy: ClusterFirstWithHostNet
                        tolerations:
                          - operator: Exists
                        containers:
                          - name: omni-kube-service-exposer
                            image: ghcr.io/siderolabs/kube-service-exposer:v0.2.0
                            args:
                              - --debug=false
                              - --annotation-key=omni-kube-service-exposer.sidero.dev/port
                              # siderolink CIDR
                              - --bind-cidrs="fdae:41e4:649b:9303::/64"
                              - --disallowed-host-port-ranges=6443,10250,50000-50001
        - |
          machine:
              install:
                  disk: /dev/sda
        - "machine:\r\n  kernel:\r\n    modules:\r\n      - name: nvidia\r\n      - name: nvidia_uvm\r\n      - name: nvidia_drm\r\n      - name: nvidia_modeset\r\n  sysctls:\r\n    net.core.bpf_jit_harden: 1"
        - "machine:\r\n  network:\r\n    hostname: homelab-04"
        - |
          apiVersion: v1alpha1
          kind: UserVolumeConfig
          name: jellyfin
          provisioning:
            diskSelector:
              match: 'system_disk'
            minSize: 500GiB
            maxSize: 1500GiB
          filesystem:
            type: xfs
