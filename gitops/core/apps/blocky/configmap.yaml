apiVersion: v1
kind: ConfigMap
metadata:
  name: blocky-config
  namespace: blocky
data:
  config.yaml: |
    # Bootstrap DNS for resolving blocklist URLs during startup
    bootstrapDns:
      - tcp+udp:1.1.1.1
      - tcp+udp:8.8.8.8

    # Upstream DNS servers
    upstreams:
      groups:
        default:
          - 1.1.1.1
          - 8.8.8.8

    # Conditional forwarding for internal domains
    # conditional:
    #   mapping:
    #     home.lan: 192.168.1.1

    # Ad-blocking configuration - Hagezi Pro (actively maintained 2025)
    blocking:
      denylists:
        ads:
          - https://raw.githubusercontent.com/hagezi/dns-blocklists/main/domains/pro.txt
      clientGroupsBlock:
        default:
          - ads
      # Block response type (zeroIp returns 0.0.0.0)
      blockType: zeroIp

    # Custom DNS mappings (local overrides)
    customDNS:
      mapping:
        # Gateway services (Cilium Gateway API on .194)
        argocd.phillips-homelab.net: 192.168.10.194
        monitoring.phillips-homelab.net: 192.168.10.194
        zot.phillips-homelab.net: 192.168.10.194
        home-assistant.phillips-homelab.net: 192.168.10.194
        jellyfin.phillips-homelab.net: 192.168.10.194
        files.phillips-homelab.net: 192.168.10.194
        openwebui.phillips-homelab.net: 192.168.10.194
        blocky.phillips-homelab.net: 192.168.10.194
        # Registry mirror
        dockerhub.phillips-homelab.net: 192.168.10.195

    # Prometheus metrics for VictoriaMetrics scraping
    prometheus:
      enable: true
      path: /metrics

    # Port configuration
    ports:
      dns: 53
      http: 4000

    # Logging configuration
    log:
      level: info
      format: text

    # Caching configuration
    caching:
      minTime: 5m
      maxTime: 30m
      prefetching: true
